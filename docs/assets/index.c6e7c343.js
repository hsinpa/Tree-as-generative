var le=Object.defineProperty;var ce=(n,t,e)=>t in n?le(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>(ce(n,typeof t!="symbol"?t+"":t,e),e);const fe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}};fe();var mt=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function E(){var n=new mt(2);return mt!=Float32Array&&(n[0]=0,n[1]=0),n}function L(n,t){var e=new mt(2);return e[0]=n,e[1]=t,e}function Ut(n,t){return n[0]=t[0],n[1]=t[1],n}function V(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n}function J(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}function yt(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n}function Ft(n,t){var e=t[0]-n[0],r=t[1]-n[1];return Math.hypot(e,r)}function tt(n,t){var e=t[0],r=t[1],i=e*e+r*r;return i>0&&(i=1/Math.sqrt(i)),n[0]=t[0]*i,n[1]=t[1]*i,n}function $t(n,t,e,r){var i=t[0],s=t[1];return n[0]=i+r*(e[0]-i),n[1]=s+r*(e[1]-s),n}function de(n,t,e,r){var i=t[0]-e[0],s=t[1]-e[1],o=Math.sin(r),a=Math.cos(r);return n[0]=i*a-s*o+e[0],n[1]=i*o+s*a+e[1],n}(function(){var n=E();return function(t,e,r,i,s,o){var a,l;for(e||(e=2),r||(r=0),i?l=Math.min(i*e+r,t.length):l=t.length,a=r;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],s(n,n,o),t[a]=n[0],t[a+1]=n[1];return t}})();const v=9007199254740992,q=v-1,et=-1>>>0,S=et+1,T=S/2,ut=T-1,H=1<<21,P=H-1;function St(n){return n.next()|0}function O(n,t){return t===0?n:e=>n(e)+t}function gt(n){const t=n.next()|0,e=n.next()>>>0;return(t&P)*S+e+(t&H?-v:0)}function Xt(n){for(;;){const t=n.next()|0;if(t&4194304){if((t&8388607)===4194304&&(n.next()|0)===0)return v}else{const e=n.next()>>>0;return(t&P)*S+e+(t&H?-v:0)}}}function Yt(n){return n.next()>>>0}function nt(n){const t=n.next()&P,e=n.next()>>>0;return t*S+e}function At(n){for(;;){const t=n.next()|0;if(t&H){if((t&P)===0&&(n.next()|0)===0)return v}else{const e=n.next()>>>0;return(t&P)*S+e}}}function Jt(n){return(n+1&n)===0}function pe(n){return t=>t.next()&n}function _e(n){const t=n+1,e=t*Math.floor(S/t);return r=>{let i=0;do i=r.next()>>>0;while(i>=e);return i%t}}function ve(n){return Jt(n)?pe(n):_e(n)}function me(n){return(n|0)===0}function ye(n){return t=>{const e=t.next()&n,r=t.next()>>>0;return e*S+r}}function ge(n){const t=n*Math.floor(v/n);return e=>{let r=0;do{const i=e.next()&P,s=e.next()>>>0;r=i*S+s}while(r>=t);return r%n}}function xe(n){const t=n+1;if(me(t)){const e=(t/S|0)-1;if(Jt(e))return ye(e)}return ge(t)}function Bt(n,t){return e=>{let r=0;do{const i=e.next()|0,s=e.next()>>>0;r=(i&P)*S+s+(i&H?-v:0)}while(r<n||r>t);return r}}function U(n,t){if(n=Math.floor(n),t=Math.floor(t),n<-v||!isFinite(n))throw new RangeError(`Expected min to be at least ${-v}`);if(t>v||!isFinite(t))throw new RangeError(`Expected max to be at most ${v}`);const e=t-n;return e<=0||!isFinite(e)?()=>n:e===et?n===0?Yt:O(St,n+T):e<et?O(ve(e),n):e===q?O(nt,n):e<q?O(xe(e),n):t-1-n===q?O(At,n):n===-v&&t===v?Xt:n===-v&&t===q?gt:n===-q&&t===v?O(gt,1):t===v?O(Bt(n-1,t-1),1):Bt(n,t)}function we(n){return(n.next()&1)===1}function xt(n,t){return e=>n(e)<t}function Ee(n){if(n<=0)return()=>!1;if(n>=1)return()=>!0;{const t=n*S;return t%1===0?xt(St,t-T|0):xt(nt,Math.round(n*v))}}function Ie(n,t){return t==null?n==null?we:Ee(n):n<=0?()=>!1:n>=t?()=>!0:xt(U(0,t-1),n)}function be(n,t){const e=U(+n,+t);return r=>new Date(e(r))}function te(n){return U(1,n)}function Se(n,t){const e=te(n);return r=>{const i=[];for(let s=0;s<t;++s)i.push(e(r));return i}}const Ae="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";function Dt(n=Ae){const t=n.length;if(!t)throw new Error("Expected pool not to be an empty string");const e=U(0,t-1);return(r,i)=>{let s="";for(let o=0;o<i;++o){const a=e(r);s+=n.charAt(a)}return s}}const ee="0123456789abcdef",De=Dt(ee),Ne=Dt(ee.toUpperCase());function Te(n){return n?Ne:De}function zt(n,t){return n<0?Math.max(n+t,0):Math.min(n,t)}function qt(n){const t=+n;return t<0?Math.ceil(t):Math.floor(t)}function ke(n,t,e,r){const i=t.length;if(i===0)throw new RangeError("Cannot pick from an empty array");const s=e==null?0:zt(qt(e),i),o=r===void 0?i:zt(qt(r),i);if(s>=o)throw new RangeError(`Cannot pick between bounds ${s} and ${o}`);const a=U(s,o-1);return t[a(n)]}function Oe(n,t){return t===1?n:t===0?()=>0:e=>n(e)*t}function ne(n){return nt(n)/v}function re(n){return At(n)/v}function Re(n,t,e=!1){if(isFinite(n)){if(!isFinite(t))throw new RangeError("Expected max to be a finite number")}else throw new RangeError("Expected min to be a finite number");return O(Oe(e?re:ne,t-n),n)}const Le=Array.prototype.slice;function wt(n,t,e=0){const r=t.length;if(r)for(let i=r-1>>>0;i>e;--i){const o=U(0,i)(n);if(i!==o){const a=t[i];t[i]=t[o],t[o]=a}}return t}function Ce(n,t,e){if(e<0||e>t.length||!isFinite(e))throw new RangeError("Expected sampleSize to be within 0 and the length of the population");if(e===0)return[];const r=Le.call(t),i=r.length;if(i===e)return wt(n,r,0);const s=i-e;return wt(n,r,s-1).slice(s)}const Me=(()=>{try{if("x".repeat(3)==="xxx")return(n,t)=>n.repeat(t)}catch{}return(n,t)=>{let e="";for(;t>0;)t&1&&(e+=n),t>>=1,n+=n;return e}})();function F(n,t){return Me("0",t-n.length)+n}function Pe(n){const t=n.next()>>>0,e=n.next()|0,r=n.next()|0,i=n.next()>>>0;return F(t.toString(16),8)+"-"+F((e&65535).toString(16),4)+"-"+F((e>>4&4095|16384).toString(16),4)+"-"+F((r&16383|32768).toString(16),4)+"-"+F((r>>4&65535).toString(16),4)+F(i.toString(16),8)}const ie={next(){return Math.random()*S|0}};class jt{constructor(t=ie){this.engine=t}int32(){return St(this.engine)}uint32(){return Yt(this.engine)}uint53(){return nt(this.engine)}uint53Full(){return At(this.engine)}int53(){return gt(this.engine)}int53Full(){return Xt(this.engine)}integer(t,e){return U(t,e)(this.engine)}realZeroToOneInclusive(){return re(this.engine)}realZeroToOneExclusive(){return ne(this.engine)}real(t,e,r=!1){return Re(t,e,r)(this.engine)}bool(t,e){return Ie(t,e)(this.engine)}pick(t,e,r){return ke(this.engine,t,e,r)}shuffle(t){return wt(this.engine,t)}sample(t,e){return Ce(this.engine,t,e)}die(t){return te(t)(this.engine)}dice(t,e){return Se(t,e)(this.engine)}uuid4(){return Pe(this.engine)}string(t,e){return Dt(e)(this.engine,t)}hex(t,e){return Te(e)(this.engine,t)}date(t,e){return be(t,e)(this.engine)}}const Ue=(()=>{try{const n=new ArrayBuffer(4),t=new Int32Array(n);if(t[0]=T,t[0]===-T)return Int32Array}catch{}return Array})();function Fe(n=ie,t=16){const e=[];e.push(new Date().getTime()|0);for(let r=1;r<t;++r)e[r]=n.next()|0;return e}const Et=(()=>{try{if(Math.imul(et,5)===-5)return Math.imul}catch{}const n=65535;return(t,e)=>{const r=t>>>16&n,i=t&n,s=e>>>16&n,o=e&n;return i*o+(r*o+i*s<<16>>>0)|0}})(),N=624,R=N-1,It=397,Vt=N-It,lt=2567483615;class B{constructor(){this.data=new Ue(N),this.index=0,this.uses=0}static seed(t){return new B().seed(t)}static seedWithArray(t){return new B().seedWithArray(t)}static autoSeed(){return B.seedWithArray(Fe())}next(){(this.index|0)>=N&&(ct(this.data),this.index=0);const t=this.data[this.index];return this.index=this.index+1|0,this.uses+=1,$e(t)|0}getUseCount(){return this.uses}discard(t){if(t<=0)return this;for(this.uses+=t,(this.index|0)>=N&&(ct(this.data),this.index=0);t+this.index>N;)t-=N-this.index,ct(this.data),this.index=0;return this.index=this.index+t|0,this}seed(t){let e=0;this.data[0]=e=t|0;for(let r=1;r<N;r=r+1|0)this.data[r]=e=Et(e^e>>>30,1812433253)+r|0;return this.index=N,this.uses=0,this}seedWithArray(t){return this.seed(19650218),Be(this.data,t),this}}function ct(n){let t=0,e=0;for(;(t|0)<Vt;t=t+1|0)e=n[t]&T|n[t+1|0]&ut,n[t]=n[t+It|0]^e>>>1^(e&1?lt:0);for(;(t|0)<R;t=t+1|0)e=n[t]&T|n[t+1|0]&ut,n[t]=n[t-Vt|0]^e>>>1^(e&1?lt:0);e=n[R]&T|n[0]&ut,n[R]=n[It-1]^e>>>1^(e&1?lt:0)}function $e(n){return n^=n>>>11,n^=n<<7&2636928640,n^=n<<15&4022730752,n^n>>>18}function Be(n,t){let e=1,r=0;const i=t.length;let s=Math.max(i,N)|0,o=n[0]|0;for(;(s|0)>0;--s)n[e]=o=(n[e]^Et(o^o>>>30,1664525))+(t[r]|0)+(r|0)|0,e=e+1|0,++r,(e|0)>R&&(n[0]=n[R],e=1),r>=i&&(r=0);for(s=R;(s|0)>0;--s)n[e]=o=(n[e]^Et(o^o>>>30,1566083941))-e|0,e=e+1|0,(e|0)>R&&(n[0]=n[R],e=1);n[0]=T}const D=Object.freeze({up:"up",down:"down",left:"left",right:"right"}),K=Object.create({w:D.up,s:D.down,d:D.right,a:D.left,arrowup:D.up,arrowdown:D.down,arrowright:D.right,arrowleft:D.left}),Ht=Object.freeze({Left:L(2,0),Right:L(0,2)});var X=(n=>(n[n.Hover=0]="Hover",n[n.Down=1]="Down",n[n.Up=2]="Up",n))(X||{});class ze{constructor(){c(this,"_buttonState",Object.create({}));c(this,"_keyboardCallback");c(this,"_cacheKeyboardDirection",E())}get MovementDirection(){return this._cacheKeyboardDirection}GetButtonState(t){return!1}RegisterButtonEvent(t){window.addEventListener("click",e=>{t()})}RegisterMouseMovement(t,e){t.requestPointerLock();let r=[0,0];window.addEventListener("mousemove",i=>{r[0]=i.movementX,r[1]=i.movementY,e(r)})}RegisterMovementEvent(t){this._keyboardCallback=t,window.addEventListener("keydown",e=>{let r=e.key.toLowerCase();r in K&&this.SetKeyboardState(K[r],!0)}),window.addEventListener("keyup",e=>{let r=e.key.toLowerCase();r in K&&this.SetKeyboardState(K[r],!1)})}OnUpdate(){this._cacheKeyboardDirection[0]=-1,this._cacheKeyboardDirection[1]=-1,this._buttonState.hasOwnProperty(D.left)&&V(this._cacheKeyboardDirection,this._cacheKeyboardDirection,Ht.Left),this._buttonState.hasOwnProperty(D.right)&&V(this._cacheKeyboardDirection,this._cacheKeyboardDirection,Ht.Right),this._keyboardCallback!=null&&this._keyboardCallback(this._cacheKeyboardDirection)}SetKeyboardState(t,e){e?this._buttonState[t]=!0:delete this._buttonState[t]}}class qe{constructor(t){c(this,"_canvasDom");c(this,"_context");c(this,"screenHeight");c(this,"screenWidth");c(this,"IsProgramValid",!1);this._canvasDom=document.querySelector(t),this.IsProgramValid=this._canvasDom!=null,this.IsProgramValid&&(this._context=this._canvasDom.getContext("2d"),this.RegisterDomEvent(),this.SetCanvasSize())}get ScreenHeight(){return this._canvasDom.height}get ScreenWidth(){return this._canvasDom.width}get Context(){return this._context}get Dom(){return this._canvasDom}RegisterDomEvent(){window.addEventListener("resize",()=>{this.SetCanvasSize()})}SetCanvasSize(){this.SetCanvasToSceenSize(this._canvasDom)}SetCanvasToSceenSize(t){t.width=window.innerWidth,t.height=window.innerHeight}}var z=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},m={},x={},b={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=Object.prototype.hasOwnProperty;n.has=function(u,f){return t.call(u,f)};function e(u,f){return u<f?-1:u===f?0:1}n.defaultCompare=e;function r(u,f){return u===f}n.defaultEquals=r;function i(u){return u===null?"COLLECTION_NULL":a(u)?"COLLECTION_UNDEFINED":l(u)?"$s"+u:"$o"+u.toString()}n.defaultToString=i;function s(u,f){if(f===void 0&&(f=","),u===null)return"COLLECTION_NULL";if(a(u))return"COLLECTION_UNDEFINED";if(l(u))return u.toString();var p="{",y=!0;for(var w in u)n.has(u,w)&&(y?y=!1:p=p+f,p=p+w+":"+u[w]);return p+"}"}n.makeString=s;function o(u){return typeof u=="function"}n.isFunction=o;function a(u){return typeof u=="undefined"}n.isUndefined=a;function l(u){return Object.prototype.toString.call(u)==="[object String]"}n.isString=l;function h(u){return a(u)||!o(u)?function(f,p){return f<p?1:f===p?0:-1}:function(f,p){return u(f,p)*-1}}n.reverseCompareFunction=h;function d(u){return function(f,p){return u(f,p)===0}}n.compareToEquals=d})(b);Object.defineProperty(x,"__esModule",{value:!0});var rt=b;function Nt(n,t,e){for(var r=e||rt.defaultEquals,i=n.length,s=0;s<i;s++)if(r(n[s],t))return s;return-1}x.indexOf=Nt;function je(n,t,e){for(var r=e||rt.defaultEquals,i=n.length,s=i-1;s>=0;s--)if(r(n[s],t))return s;return-1}x.lastIndexOf=je;function Ve(n,t,e){return Nt(n,t,e)>=0}x.contains=Ve;function He(n,t,e){var r=Nt(n,t,e);return r<0?!1:(n.splice(r,1),!0)}x.remove=He;function We(n,t,e){for(var r=e||rt.defaultEquals,i=n.length,s=0,o=0;o<i;o++)r(n[o],t)&&s++;return s}x.frequency=We;function Ke(n,t,e){var r=e||rt.defaultEquals;if(n.length!==t.length)return!1;for(var i=n.length,s=0;s<i;s++)if(!r(n[s],t[s]))return!1;return!0}x.equals=Ke;function Ge(n){return n.concat()}x.copy=Ge;function Qe(n,t,e){if(t<0||t>=n.length||e<0||e>=n.length)return!1;var r=n[t];return n[t]=n[e],n[e]=r,!0}x.swap=Qe;function Ze(n){return"["+n.toString()+"]"}x.toString=Ze;function Xe(n,t){for(var e=0,r=n;e<r.length;e++){var i=r[e];if(t(i)===!1)return}}x.forEach=Xe;var Tt={},C={};Object.defineProperty(C,"__esModule",{value:!0});var A=b,Ye=function(){function n(t){this.table={},this.nElements=0,this.toStr=t||A.defaultToString}return n.prototype.getValue=function(t){var e=this.table["$"+this.toStr(t)];if(!A.isUndefined(e))return e.value},n.prototype.setValue=function(t,e){if(!(A.isUndefined(t)||A.isUndefined(e))){var r,i="$"+this.toStr(t),s=this.table[i];return A.isUndefined(s)?(this.nElements++,r=void 0):r=s.value,this.table[i]={key:t,value:e},r}},n.prototype.remove=function(t){var e="$"+this.toStr(t),r=this.table[e];if(!A.isUndefined(r))return delete this.table[e],this.nElements--,r.value},n.prototype.keys=function(){var t=[];for(var e in this.table)if(A.has(this.table,e)){var r=this.table[e];t.push(r.key)}return t},n.prototype.values=function(){var t=[];for(var e in this.table)if(A.has(this.table,e)){var r=this.table[e];t.push(r.value)}return t},n.prototype.forEach=function(t){for(var e in this.table)if(A.has(this.table,e)){var r=this.table[e],i=t(r.key,r.value);if(i===!1)return}},n.prototype.containsKey=function(t){return!A.isUndefined(this.getValue(t))},n.prototype.clear=function(){this.table={},this.nElements=0},n.prototype.size=function(){return this.nElements},n.prototype.isEmpty=function(){return this.nElements<=0},n.prototype.toString=function(){var t="{";return this.forEach(function(e,r){t+=`
	`+e+" : "+r}),t+`
}`},n}();C.default=Ye;var it={};Object.defineProperty(it,"__esModule",{value:!0});var Je=b,tn=x,en=C,nn=function(){function n(t){this.dictionary=new en.default(t)}return n.prototype.contains=function(t){return this.dictionary.containsKey(t)},n.prototype.add=function(t){return this.contains(t)||Je.isUndefined(t)?!1:(this.dictionary.setValue(t,t),!0)},n.prototype.intersection=function(t){var e=this;this.forEach(function(r){return t.contains(r)||e.remove(r),!0})},n.prototype.union=function(t){var e=this;t.forEach(function(r){return e.add(r),!0})},n.prototype.difference=function(t){var e=this;t.forEach(function(r){return e.remove(r),!0})},n.prototype.isSubsetOf=function(t){if(this.size()>t.size())return!1;var e=!0;return this.forEach(function(r){return t.contains(r)?!0:(e=!1,!1)}),e},n.prototype.remove=function(t){return this.contains(t)?(this.dictionary.remove(t),!0):!1},n.prototype.forEach=function(t){this.dictionary.forEach(function(e,r){return t(r)})},n.prototype.toArray=function(){return this.dictionary.values()},n.prototype.isEmpty=function(){return this.dictionary.isEmpty()},n.prototype.size=function(){return this.dictionary.size()},n.prototype.clear=function(){this.dictionary.clear()},n.prototype.toString=function(){return tn.toString(this.toArray())},n}();it.default=nn;Object.defineProperty(Tt,"__esModule",{value:!0});var ft=b,rn=C,sn=it,on=function(){function n(t){this.toStrF=t||ft.defaultToString,this.dictionary=new rn.default(this.toStrF),this.nElements=0}return n.prototype.add=function(t,e){if(e===void 0&&(e=1),ft.isUndefined(t)||e<=0)return!1;if(this.contains(t))this.dictionary.getValue(t).copies+=e;else{var r={value:t,copies:e};this.dictionary.setValue(t,r)}return this.nElements+=e,!0},n.prototype.count=function(t){return this.contains(t)?this.dictionary.getValue(t).copies:0},n.prototype.contains=function(t){return this.dictionary.containsKey(t)},n.prototype.remove=function(t,e){if(e===void 0&&(e=1),ft.isUndefined(t)||e<=0)return!1;if(this.contains(t)){var r=this.dictionary.getValue(t);return e>r.copies?this.nElements-=r.copies:this.nElements-=e,r.copies-=e,r.copies<=0&&this.dictionary.remove(t),!0}else return!1},n.prototype.toArray=function(){for(var t=[],e=this.dictionary.values(),r=0,i=e;r<i.length;r++)for(var s=i[r],o=s.value,a=s.copies,l=0;l<a;l++)t.push(o);return t},n.prototype.toSet=function(){for(var t=new sn.default(this.toStrF),e=this.dictionary.values(),r=0,i=e;r<i.length;r++){var s=i[r],o=s.value;t.add(o)}return t},n.prototype.forEach=function(t){this.dictionary.forEach(function(e,r){for(var i=r.value,s=r.copies,o=0;o<s;o++)if(t(i)===!1)return!1;return!0})},n.prototype.size=function(){return this.nElements},n.prototype.isEmpty=function(){return this.nElements===0},n.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},n}();Tt.default=on;var kt={},st={},ot={},W={};Object.defineProperty(W,"__esModule",{value:!0});var M=b,an=x,hn=function(){function n(){this.firstNode=null,this.lastNode=null,this.nElements=0}return n.prototype.add=function(t,e){if(M.isUndefined(e)&&(e=this.nElements),e<0||e>this.nElements||M.isUndefined(t))return!1;var r=this.createNode(t);if(this.nElements===0||this.lastNode===null)this.firstNode=r,this.lastNode=r;else if(e===this.nElements)this.lastNode.next=r,this.lastNode=r;else if(e===0)r.next=this.firstNode,this.firstNode=r;else{var i=this.nodeAtIndex(e-1);if(i===null)return!1;r.next=i.next,i.next=r}return this.nElements++,!0},n.prototype.first=function(){if(this.firstNode!==null)return this.firstNode.element},n.prototype.last=function(){if(this.lastNode!==null)return this.lastNode.element},n.prototype.elementAtIndex=function(t){var e=this.nodeAtIndex(t);if(e!==null)return e.element},n.prototype.indexOf=function(t,e){var r=e||M.defaultEquals;if(M.isUndefined(t))return-1;for(var i=this.firstNode,s=0;i!==null;){if(r(i.element,t))return s;s++,i=i.next}return-1},n.prototype.contains=function(t,e){return this.indexOf(t,e)>=0},n.prototype.remove=function(t,e){var r=e||M.defaultEquals;if(this.nElements<1||M.isUndefined(t))return!1;for(var i=null,s=this.firstNode;s!==null;){if(r(s.element,t))return i===null?(this.firstNode=s.next,s===this.lastNode&&(this.lastNode=null)):s===this.lastNode?(this.lastNode=i,i.next=s.next,s.next=null):(i.next=s.next,s.next=null),this.nElements--,!0;i=s,s=s.next}return!1},n.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},n.prototype.equals=function(t,e){var r=e||M.defaultEquals;return!(t instanceof n)||this.size()!==t.size()?!1:this.equalsAux(this.firstNode,t.firstNode,r)},n.prototype.equalsAux=function(t,e,r){for(;t!==null&&e!==null;){if(!r(t.element,e.element))return!1;t=t.next,e=e.next}return!0},n.prototype.removeElementAtIndex=function(t){if(!(t<0||t>=this.nElements||this.firstNode===null||this.lastNode===null)){var e;if(this.nElements===1)e=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var r=this.nodeAtIndex(t-1);r===null?(e=this.firstNode.element,this.firstNode=this.firstNode.next):r.next===this.lastNode&&(e=this.lastNode.element,this.lastNode=r),r!==null&&r.next!==null&&(e=r.next.element,r.next=r.next.next)}return this.nElements--,e}},n.prototype.forEach=function(t){for(var e=this.firstNode;e!==null&&t(e.element)!==!1;)e=e.next},n.prototype.reverse=function(){for(var t=null,e=this.firstNode,r=null;e!==null;)r=e.next,e.next=t,t=e,e=r;r=this.firstNode,this.firstNode=this.lastNode,this.lastNode=r},n.prototype.toArray=function(){for(var t=[],e=this.firstNode;e!==null;)t.push(e.element),e=e.next;return t},n.prototype.size=function(){return this.nElements},n.prototype.isEmpty=function(){return this.nElements<=0},n.prototype.toString=function(){return an.toString(this.toArray())},n.prototype.nodeAtIndex=function(t){if(t<0||t>=this.nElements)return null;if(t===this.nElements-1)return this.lastNode;for(var e=this.firstNode,r=0;r<t&&e!==null;r++)e=e.next;return e},n.prototype.createNode=function(t){return{element:t,next:null}},n}();W.default=hn;Object.defineProperty(ot,"__esModule",{value:!0});var un=W,ln=function(){function n(){this.list=new un.default}return n.prototype.enqueue=function(t){return this.list.add(t)},n.prototype.add=function(t){return this.list.add(t)},n.prototype.dequeue=function(){if(this.list.size()!==0){var t=this.list.first();return this.list.removeElementAtIndex(0),t}},n.prototype.peek=function(){if(this.list.size()!==0)return this.list.first()},n.prototype.size=function(){return this.list.size()},n.prototype.contains=function(t,e){return this.list.contains(t,e)},n.prototype.isEmpty=function(){return this.list.size()<=0},n.prototype.clear=function(){this.list.clear()},n.prototype.forEach=function(t){this.list.forEach(t)},n}();ot.default=ln;Object.defineProperty(st,"__esModule",{value:!0});var dt=b,cn=ot,fn=function(){function n(t){this.root=null,this.compare=t||dt.defaultCompare,this.nElements=0}return n.prototype.add=function(t){return dt.isUndefined(t)?!1:this.insertNode(this.createNode(t))!==null?(this.nElements++,!0):!1},n.prototype.clear=function(){this.root=null,this.nElements=0},n.prototype.isEmpty=function(){return this.nElements===0},n.prototype.size=function(){return this.nElements},n.prototype.contains=function(t){return dt.isUndefined(t)?!1:this.searchNode(this.root,t)!==null},n.prototype.search=function(t){var e=this.searchNode(this.root,t);if(e!==null)return e.element},n.prototype.remove=function(t){var e=this.searchNode(this.root,t);return e===null?!1:(this.removeNode(e),this.nElements--,!0)},n.prototype.inorderTraversal=function(t){this.inorderTraversalAux(this.root,t,{stop:!1})},n.prototype.preorderTraversal=function(t){this.preorderTraversalAux(this.root,t,{stop:!1})},n.prototype.postorderTraversal=function(t){this.postorderTraversalAux(this.root,t,{stop:!1})},n.prototype.levelTraversal=function(t){this.levelTraversalAux(this.root,t)},n.prototype.minimum=function(){if(!(this.isEmpty()||this.root===null))return this.minimumAux(this.root).element},n.prototype.maximum=function(){if(!(this.isEmpty()||this.root===null))return this.maximumAux(this.root).element},n.prototype.forEach=function(t){this.inorderTraversal(t)},n.prototype.toArray=function(){var t=[];return this.inorderTraversal(function(e){return t.push(e),!0}),t},n.prototype.height=function(){return this.heightAux(this.root)},n.prototype.searchNode=function(t,e){for(var r=1;t!==null&&r!==0;)r=this.compare(e,t.element),r<0?t=t.leftCh:r>0&&(t=t.rightCh);return t},n.prototype.transplant=function(t,e){t.parent===null?this.root=e:t===t.parent.leftCh?t.parent.leftCh=e:t.parent.rightCh=e,e!==null&&(e.parent=t.parent)},n.prototype.removeNode=function(t){if(t.leftCh===null)this.transplant(t,t.rightCh);else if(t.rightCh===null)this.transplant(t,t.leftCh);else{var e=this.minimumAux(t.rightCh);e.parent!==t&&(this.transplant(e,e.rightCh),e.rightCh=t.rightCh,e.rightCh.parent=e),this.transplant(t,e),e.leftCh=t.leftCh,e.leftCh.parent=e}},n.prototype.inorderTraversalAux=function(t,e,r){t===null||r.stop||(this.inorderTraversalAux(t.leftCh,e,r),!r.stop&&(r.stop=e(t.element)===!1,!r.stop&&this.inorderTraversalAux(t.rightCh,e,r)))},n.prototype.levelTraversalAux=function(t,e){var r=new cn.default;for(t!==null&&r.enqueue(t),t=r.dequeue()||null;t!=null;){if(e(t.element)===!1)return;t.leftCh!==null&&r.enqueue(t.leftCh),t.rightCh!==null&&r.enqueue(t.rightCh),t=r.dequeue()||null}},n.prototype.preorderTraversalAux=function(t,e,r){t===null||r.stop||(r.stop=e(t.element)===!1,!r.stop&&(this.preorderTraversalAux(t.leftCh,e,r),!r.stop&&this.preorderTraversalAux(t.rightCh,e,r)))},n.prototype.postorderTraversalAux=function(t,e,r){t===null||r.stop||(this.postorderTraversalAux(t.leftCh,e,r),!r.stop&&(this.postorderTraversalAux(t.rightCh,e,r),!r.stop&&(r.stop=e(t.element)===!1)))},n.prototype.minimumAux=function(t){for(;t!=null&&t.leftCh!==null;)t=t.leftCh;return t},n.prototype.maximumAux=function(t){for(;t!=null&&t.rightCh!==null;)t=t.rightCh;return t},n.prototype.heightAux=function(t){return t===null?-1:Math.max(this.heightAux(t.leftCh),this.heightAux(t.rightCh))+1},n.prototype.insertNode=function(t){for(var e=null,r=this.root;r!==null;){var i=this.compare(t.element,r.element);if(i===0)return null;i<0?(e=r,r=r.leftCh):(e=r,r=r.rightCh)}return t.parent=e,e===null?this.root=t:this.compare(t.element,e.element)<0?e.leftCh=t:e.rightCh=t,t},n.prototype.createNode=function(t){return{element:t,leftCh:null,rightCh:null,parent:null}},n}();st.default=fn;var dn=z&&z.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(kt,"__esModule",{value:!0});var pn=st,_n=function(n){dn(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t}(pn.default);kt.default=_n;var at={};Object.defineProperty(at,"__esModule",{value:!0});var pt=b,G=x,vn=function(){function n(t){this.data=[],this.compare=t||pt.defaultCompare}return n.prototype.leftChildIndex=function(t){return 2*t+1},n.prototype.rightChildIndex=function(t){return 2*t+2},n.prototype.parentIndex=function(t){return Math.floor((t-1)/2)},n.prototype.minIndex=function(t,e){return e>=this.data.length?t>=this.data.length?-1:t:this.compare(this.data[t],this.data[e])<=0?t:e},n.prototype.siftUp=function(t){for(var e=this.parentIndex(t);t>0&&this.compare(this.data[e],this.data[t])>0;)G.swap(this.data,e,t),t=e,e=this.parentIndex(t)},n.prototype.siftDown=function(t){for(var e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t));e>=0&&this.compare(this.data[t],this.data[e])>0;)G.swap(this.data,e,t),t=e,e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t))},n.prototype.peek=function(){if(this.data.length>0)return this.data[0]},n.prototype.add=function(t){return pt.isUndefined(t)?!1:(this.data.push(t),this.siftUp(this.data.length-1),!0)},n.prototype.removeRoot=function(){if(this.data.length>0){var t=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),t}},n.prototype.contains=function(t){var e=pt.compareToEquals(this.compare);return G.contains(this.data,t,e)},n.prototype.size=function(){return this.data.length},n.prototype.isEmpty=function(){return this.data.length<=0},n.prototype.clear=function(){this.data.length=0},n.prototype.forEach=function(t){G.forEach(this.data,t)},n}();at.default=vn;var Ot={},mn=z&&z.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(Ot,"__esModule",{value:!0});var yn=C,$=b,gn=function(){function n(t,e){this.key=t,this.value=e}return n.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},n}(),Wt=function(){function n(){this.key=null,this.value=null}return n.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},n}();function xn(n){return!n.next}var wn=function(n){mn(t,n);function t(e){var r=n.call(this,e)||this;return r.head=new Wt,r.tail=new Wt,r.head.next=r.tail,r.tail.prev=r.head,r}return t.prototype.appendToTail=function(e){var r=this.tail.prev;r.next=e,e.prev=r,e.next=this.tail,this.tail.prev=e},t.prototype.getLinkedDictionaryPair=function(e){if(!$.isUndefined(e)){var r="$"+this.toStr(e),i=this.table[r];return i}},t.prototype.getValue=function(e){var r=this.getLinkedDictionaryPair(e);if(!$.isUndefined(r))return r.value},t.prototype.remove=function(e){var r=this.getLinkedDictionaryPair(e);if(!$.isUndefined(r))return n.prototype.remove.call(this,e),r.unlink(),r.value},t.prototype.clear=function(){n.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},t.prototype.replace=function(e,r){var i="$"+this.toStr(r.key);r.next=e.next,r.prev=e.prev,this.remove(e.key),r.prev.next=r,r.next.prev=r,this.table[i]=r,++this.nElements},t.prototype.setValue=function(e,r){if(!($.isUndefined(e)||$.isUndefined(r))){var i=this.getLinkedDictionaryPair(e),s=new gn(e,r),o="$"+this.toStr(e);if($.isUndefined(i)){this.appendToTail(s),this.table[o]=s,++this.nElements;return}else return this.replace(i,s),i.value}},t.prototype.keys=function(){var e=[];return this.forEach(function(r,i){e.push(r)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(r,i){e.push(i)}),e},t.prototype.forEach=function(e){for(var r=this.head.next;!xn(r);){var i=e(r.key,r.value);if(i===!1)return;r=r.next}},t}(yn.default);Ot.default=wn;var Rt={};Object.defineProperty(Rt,"__esModule",{value:!0});var k=b,En=C,_t=x,In=function(){function n(t,e,r){r===void 0&&(r=!1),this.dict=new En.default(t),this.equalsF=e||k.defaultEquals,this.allowDuplicate=r}return n.prototype.getValue=function(t){var e=this.dict.getValue(t);return k.isUndefined(e)?[]:_t.copy(e)},n.prototype.setValue=function(t,e){if(k.isUndefined(t)||k.isUndefined(e))return!1;var r=this.dict.getValue(t);return k.isUndefined(r)?(this.dict.setValue(t,[e]),!0):!this.allowDuplicate&&_t.contains(r,e,this.equalsF)?!1:(r.push(e),!0)},n.prototype.remove=function(t,e){if(k.isUndefined(e)){var r=this.dict.remove(t);return!k.isUndefined(r)}var i=this.dict.getValue(t);return!k.isUndefined(i)&&_t.remove(i,e,this.equalsF)?(i.length===0&&this.dict.remove(t),!0):!1},n.prototype.keys=function(){return this.dict.keys()},n.prototype.values=function(){for(var t=this.dict.values(),e=[],r=0,i=t;r<i.length;r++)for(var s=i[r],o=0,a=s;o<a.length;o++){var l=a[o];e.push(l)}return e},n.prototype.containsKey=function(t){return this.dict.containsKey(t)},n.prototype.clear=function(){this.dict.clear()},n.prototype.size=function(){return this.dict.size()},n.prototype.isEmpty=function(){return this.dict.isEmpty()},n}();Rt.default=In;var ht={},bn=z&&z.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(ht,"__esModule",{value:!0});var Sn=C,An=b,Dn=function(n){bn(t,n);function t(e,r){var i=n.call(this,r)||this;return i.defaultFactoryFunction=e,i}return t.prototype.setDefault=function(e,r){var i=n.prototype.getValue.call(this,e);return An.isUndefined(i)?(this.setValue(e,r),r):i},t.prototype.getValue=function(e){return this.setDefault(e,this.defaultFactoryFunction())},t}(Sn.default);ht.default=Dn;var Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});var Nn=b,Tn=at,kn=function(){function n(t){this.heap=new Tn.default(Nn.reverseCompareFunction(t))}return n.prototype.enqueue=function(t){return this.heap.add(t)},n.prototype.add=function(t){return this.heap.add(t)},n.prototype.dequeue=function(){if(this.heap.size()!==0){var t=this.heap.peek();return this.heap.removeRoot(),t}},n.prototype.peek=function(){return this.heap.peek()},n.prototype.contains=function(t){return this.heap.contains(t)},n.prototype.isEmpty=function(){return this.heap.isEmpty()},n.prototype.size=function(){return this.heap.size()},n.prototype.clear=function(){this.heap.clear()},n.prototype.forEach=function(t){this.heap.forEach(t)},n}();Lt.default=kn;var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});var On=W,Rn=function(){function n(){this.list=new On.default}return n.prototype.push=function(t){return this.list.add(t,0)},n.prototype.add=function(t){return this.list.add(t,0)},n.prototype.pop=function(){return this.list.removeElementAtIndex(0)},n.prototype.peek=function(){return this.list.first()},n.prototype.size=function(){return this.list.size()},n.prototype.contains=function(t,e){return this.list.contains(t,e)},n.prototype.isEmpty=function(){return this.list.isEmpty()},n.prototype.clear=function(){this.list.clear()},n.prototype.forEach=function(t){this.list.forEach(t)},n}();Ct.default=Rn;var Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});var _;(function(n){n[n.BEFORE=0]="BEFORE",n[n.AFTER=1]="AFTER",n[n.INSIDE_AT_END=2]="INSIDE_AT_END",n[n.INSIDE_AT_START=3]="INSIDE_AT_START"})(_||(_={}));var Ln=function(){function n(t,e){t===void 0&&(t=[]),e===void 0&&(e={}),this.rootIds=t,this.nodes=e,this.initRootIds(),this.initNodes()}return n.prototype.initRootIds=function(){for(var t=0,e=this.rootIds;t<e.length;t++){var r=e[t];this.createEmptyNodeIfNotExist(r)}},n.prototype.initNodes=function(){for(var t in this.nodes)if(this.nodes.hasOwnProperty(t))for(var e=0,r=this.nodes[t];e<r.length;e++){var i=r[e];this.createEmptyNodeIfNotExist(i)}},n.prototype.createEmptyNodeIfNotExist=function(t){this.nodes[t]||(this.nodes[t]=[])},n.prototype.getRootIds=function(){var t=this.rootIds.slice();return t},n.prototype.getNodes=function(){var t={};for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&(t[e]=this.nodes[e].slice());return t},n.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},n.prototype.toObject=function(){return this.getObject()},n.prototype.flatten=function(){for(var t=this,e=[],r=0;r<this.rootIds.length;r++){var i=this.rootIds[r];e.push({id:i,level:0,hasParent:!1,childrenCount:0}),h(i,this.nodes,e,0)}for(var s=0,o=e;s<o.length;s++){var a=o[s];a.childrenCount=l(a.id)}return e;function l(d){if(t.nodes[d]){var u=t.nodes[d].length;return u}else return 0}function h(d,u,f,p){if(p===void 0&&(p=0),!(!d||!u||!f||!u[d])){p++;for(var y=u[d],w=0;w<y.length;w++){var I=y[w];f.push({id:I,level:p,hasParent:!0}),h(I,u,f,p)}p--}}},n.prototype.moveIdBeforeId=function(t,e){return this.moveId(t,e,_.BEFORE)},n.prototype.moveIdAfterId=function(t,e){return this.moveId(t,e,_.AFTER)},n.prototype.moveIdIntoId=function(t,e,r){return r===void 0&&(r=!0),r?this.moveId(t,e,_.INSIDE_AT_START):this.moveId(t,e,_.INSIDE_AT_END)},n.prototype.swapRootIdWithRootId=function(t,e){var r=this.findRootId(t),i=this.findRootId(e);this.swapRootPositionWithRootPosition(r,i)},n.prototype.swapRootPositionWithRootPosition=function(t,e){var r=this.rootIds[e];this.rootIds[e]=this.rootIds[t],this.rootIds[t]=r},n.prototype.deleteId=function(t){this.rootDeleteId(t),this.nodeAndSubNodesDelete(t),this.nodeRefrencesDelete(t)},n.prototype.insertIdBeforeId=function(t,e){var r=this.findRootId(t);r>-1&&this.insertIdIntoRoot(e,r);for(var i in this.nodes)if(this.nodes.hasOwnProperty(i)){var s=this.findNodeId(i,t);s>-1&&this.insertIdIntoNode(i,e,s)}},n.prototype.insertIdAfterId=function(t,e){var r=this.findRootId(t);r>-1&&this.insertIdIntoRoot(e,r+1);for(var i in this.nodes)if(this.nodes.hasOwnProperty(i)){var s=this.findNodeId(i,t);s>-1&&this.insertIdIntoNode(i,e,s+1)}},n.prototype.insertIdIntoId=function(t,e){this.nodeInsertAtEnd(t,e),this.nodes[e]=[]},n.prototype.insertIdIntoRoot=function(t,e){if(e===void 0)this.rootInsertAtEnd(t);else if(e<0){var r=this.rootIds.length;this.rootIds.splice(e+r+1,0,t)}else this.rootIds.splice(e,0,t);this.nodes[t]=this.nodes[t]||[]},n.prototype.insertIdIntoNode=function(t,e,r){if(this.nodes[t]=this.nodes[t]||[],this.nodes[e]=this.nodes[e]||[],r===void 0)this.nodeInsertAtEnd(t,e);else if(r<0){var i=this.nodes[t].length;this.nodes[t].splice(r+i+1,0,e)}else this.nodes[t].splice(r,0,e)},n.prototype.moveId=function(t,e,r){var i=t,s=this.findRootId(i);this.nodes[e];for(var o in this.nodes)if(this.nodes.hasOwnProperty(o)){this.findNodeId(o,e);break}var a=e,l=this.findRootId(a);this.nodes[e];for(var o in this.nodes)if(this.nodes.hasOwnProperty(o)){this.findNodeId(o,e);break}if(s>-1)if(l>-1)switch(this.rootDelete(s),l>s&&l--,r){case _.BEFORE:this.insertIdIntoRoot(i,l);break;case _.AFTER:this.insertIdIntoRoot(i,l+1);break;case _.INSIDE_AT_START:this.nodeInsertAtStart(a,i);break;case _.INSIDE_AT_END:this.nodeInsertAtEnd(a,i);break}else{this.rootDelete(s);for(var o in this.nodes)if(this.nodes.hasOwnProperty(o)){var h=this.findNodeId(o,a);if(h>-1){switch(r){case _.BEFORE:this.insertIdIntoNode(o,i,h);break;case _.AFTER:this.insertIdIntoNode(o,i,h+1);break;case _.INSIDE_AT_START:this.nodeInsertAtStart(a,i);break;case _.INSIDE_AT_END:this.nodeInsertAtEnd(a,i);break}break}}}else if(l>-1){for(var o in this.nodes)if(this.nodes.hasOwnProperty(o)){var h=this.findNodeId(o,i);if(h>-1){this.nodeDeleteAtIndex(o,h);break}}switch(r){case _.BEFORE:this.insertIdIntoRoot(i,l);break;case _.AFTER:this.insertIdIntoRoot(i,l+1);break;case _.INSIDE_AT_START:this.nodeInsertAtStart(a,i);break;case _.INSIDE_AT_END:this.nodeInsertAtEnd(a,i);break}}else{for(var o in this.nodes)if(this.nodes.hasOwnProperty(o)){var h=this.findNodeId(o,i);if(h>-1){this.nodeDeleteAtIndex(o,h);break}}for(var o in this.nodes)if(this.nodes.hasOwnProperty(o)){var h=this.findNodeId(o,a);if(h>-1){switch(r){case _.BEFORE:this.insertIdIntoNode(o,i,h);break;case _.AFTER:this.insertIdIntoNode(o,i,h+1);break;case _.INSIDE_AT_START:this.nodeInsertAtStart(a,i);break;case _.INSIDE_AT_END:this.nodeInsertAtEnd(a,i);break}break}}}},n.prototype.swapArrayElements=function(t,e,r){var i=t[e];return t[e]=t[r],t[r]=i,t},n.prototype.rootDeleteId=function(t){var e=this.findRootId(t);e>-1&&this.rootDelete(e)},n.prototype.nodeAndSubNodesDelete=function(t){for(var e=[],r=0;r<this.nodes[t].length;r++){var i=this.nodes[t][r];this.nodeAndSubNodesDelete(i),e.push(t)}this.nodeDelete(t);for(var r=0;r<e.length;r++)this.nodeDelete(e[r])},n.prototype.nodeRefrencesDelete=function(t){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e))for(var r=0;r<this.nodes[e].length;r++){var i=this.nodes[e][r];i===t&&this.nodeDeleteAtIndex(e,r)}},n.prototype.nodeDelete=function(t){delete this.nodes[t]},n.prototype.findRootId=function(t){return this.rootIds.indexOf(t)},n.prototype.findNodeId=function(t,e){return this.nodes[t].indexOf(e)},n.prototype.findNode=function(t){return this.nodes[t]},n.prototype.nodeInsertAtStart=function(t,e){this.nodes[t].unshift(e)},n.prototype.nodeInsertAtEnd=function(t,e){this.nodes[t].push(e)},n.prototype.rootDelete=function(t){this.rootIds.splice(t,1)},n.prototype.nodeDeleteAtIndex=function(t,e){this.nodes[t].splice(e,1)},n.prototype.rootInsertAtStart=function(t){this.rootIds.unshift(t)},n.prototype.rootInsertAtEnd=function(t){this.rootIds.push(t)},n}();Mt.default=Ln;Object.defineProperty(m,"__esModule",{value:!0});var Cn=x;m.arrays=Cn;var Mn=Tt;m.Bag=Mn.default;var Pn=kt;m.BSTree=Pn.default;var Un=st;m.BSTreeKV=Un.default;var Fn=C,$n=m.Dictionary=Fn.default,Bn=at;m.Heap=Bn.default;var zn=Ot;m.LinkedDictionary=zn.default;var qn=W;m.LinkedList=qn.default;var jn=Rt;m.MultiDictionary=jn.default;var Vn=ht;m.FactoryDictionary=Vn.default;var Hn=ht;m.DefaultDictionary=Hn.default;var Wn=ot;m.Queue=Wn.default;var Kn=Lt;m.PriorityQueue=Kn.default;var Gn=it;m.Set=Gn.default;var Qn=Ct;m.Stack=Qn.default;var Zn=Mt;m.MultiRootTree=Zn.default;var Xn=b;m.util=Xn;const se=function(n,t,e){return Math.min(Math.max(n,e),t)};function Yn(n,t,e){return(n-t)/(e-t)}function Jn(n){return new Promise(t=>{const e=new Image;return e.crossOrigin="anonymous",e.src=n,e.onload=()=>t(Object.assign(e)),e})}class tr{constructor(){c(this,"textureCache");this.textureCache=new $n}async GetImage(t){if(this.textureCache.containsKey(t))return this.textureCache.getValue(t);let e=await Jn(t);return this.textureCache.setValue(t,e),e}ForceGetImage(t){return this.textureCache.containsKey(t)?this.textureCache.getValue(t):null}}let Q;const er=new Uint8Array(16);function nr(){if(!Q&&(Q=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Q))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Q(er)}const g=[];for(let n=0;n<256;++n)g.push((n+256).toString(16).slice(1));function rr(n,t=0){return(g[n[t+0]]+g[n[t+1]]+g[n[t+2]]+g[n[t+3]]+"-"+g[n[t+4]]+g[n[t+5]]+"-"+g[n[t+6]]+g[n[t+7]]+"-"+g[n[t+8]]+g[n[t+9]]+"-"+g[n[t+10]]+g[n[t+11]]+g[n[t+12]]+g[n[t+13]]+g[n[t+14]]+g[n[t+15]]).toLowerCase()}const ir=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var Kt={randomUUID:ir};function sr(n,t,e){if(Kt.randomUUID&&!t&&!n)return Kt.randomUUID();n=n||{};const r=n.random||(n.rng||nr)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(let i=0;i<16;++i)t[e+i]=r[i];return t}return rr(r)}const or=.6;var Y=(n=>(n[n.Endpoint_Branch=0]="Endpoint_Branch",n[n.Thin_Branch=1]="Thin_Branch",n[n.Thick_Branch=2]="Thick_Branch",n))(Y||{});class Pt{constructor(t,e){c(this,"id");c(this,"position");c(this,"direction");c(this,"original_direction");c(this,"children",[]);c(this,"parent");c(this,"count",0);c(this,"branch_vertices");c(this,"branch_leaf");c(this,"candidate_count",0);c(this,"max_candidate",15);c(this,"child_count",1);c(this,"branch_type",{value:1,type:2});c(this,"kinematic_flag",0);this.id=sr(),this.position=t,this.parent=e,this.branch_vertices=Array.of(E(),E()),this.direction=E(),this.original_direction=E(),this.branch_leaf=[],this.parent!=null&&(J(this.direction,this.position,this.parent.position),tt(this.direction,this.direction),this.set_direction(this.direction,!0))}get is_vertices_set(){return this.branch_vertices[0][0]!=0&&this.branch_vertices[0][1]!=0&&this.branch_vertices[1][0]!=0&&this.branch_vertices[1][1]!=0}get thickness(){let t=this.child_count*or;return t=se(t,t,5),t}reset(){this.direction=Ut(this.direction,this.original_direction),this.count=0}set_direction(t,e=!1){this.direction=t,e&&Ut(this.original_direction,this.direction)}next(){let t=yt(E(),this.direction,20),e=V(E(),this.position,t),r=new Pt(e,this);return this.children.push(r),r}set_branch_type(t){this.branch_type.type=2;const e=.5;this.set_branch_helper(t,15,e,1),this.set_branch_helper(t,3,e,0);let r=de(E(),this.direction,L(0,0),Math.PI*.5),i=yt(E(),r,t);this.branch_vertices[0]=V(this.branch_vertices[0],this.position,i),this.branch_vertices[1]=J(this.branch_vertices[1],this.position,i)}set_branch_helper(t,e,r,i){if(t<e){let s=e-r;this.branch_type.type=i,this.branch_type.value=1,t>s&&(this.branch_type.value=Yn(t,s,e));return}}}function bt(n,t,e,r,i,s){if(i-r<=e)return;const o=r+i>>1;oe(n,t,o,r,i,s%2),bt(n,t,e,r,o-1,s+1),bt(n,t,e,o+1,i,s+1)}function oe(n,t,e,r,i,s){for(;i>r;){if(i-r>600){const h=i-r+1,d=e-r+1,u=Math.log(h),f=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*f*(h-f)/h)*(d-h/2<0?-1:1),y=Math.max(r,Math.floor(e-d*f/h+p)),w=Math.min(i,Math.floor(e+(h-d)*f/h+p));oe(n,t,e,y,w,s)}const o=t[2*e+s];let a=r,l=i;for(j(n,t,r,e),t[2*i+s]>o&&j(n,t,r,i);a<l;){for(j(n,t,a,l),a++,l--;t[2*a+s]<o;)a++;for(;t[2*l+s]>o;)l--}t[2*r+s]===o?j(n,t,r,l):(l++,j(n,t,l,i)),l<=e&&(r=l+1),e<=l&&(i=l-1)}}function j(n,t,e,r){vt(n,e,r),vt(t,2*e,2*r),vt(t,2*e+1,2*r+1)}function vt(n,t,e){const r=n[t];n[t]=n[e],n[e]=r}function ar(n,t,e,r,i,s,o){const a=[0,n.length-1,0],l=[];let h,d;for(;a.length;){const u=a.pop(),f=a.pop(),p=a.pop();if(f-p<=o){for(let I=p;I<=f;I++)h=t[2*I],d=t[2*I+1],h>=e&&h<=i&&d>=r&&d<=s&&l.push(n[I]);continue}const y=Math.floor((p+f)/2);h=t[2*y],d=t[2*y+1],h>=e&&h<=i&&d>=r&&d<=s&&l.push(n[y]);const w=(u+1)%2;(u===0?e<=h:r<=d)&&(a.push(p),a.push(y-1),a.push(w)),(u===0?i>=h:s>=d)&&(a.push(y+1),a.push(f),a.push(w))}return l}function hr(n,t,e,r,i,s){const o=[0,n.length-1,0],a=[],l=i*i;for(;o.length;){const h=o.pop(),d=o.pop(),u=o.pop();if(d-u<=s){for(let I=u;I<=d;I++)Gt(t[2*I],t[2*I+1],e,r)<=l&&a.push(n[I]);continue}const f=Math.floor((u+d)/2),p=t[2*f],y=t[2*f+1];Gt(p,y,e,r)<=l&&a.push(n[f]);const w=(h+1)%2;(h===0?e-i<=p:r-i<=y)&&(o.push(u),o.push(f-1),o.push(w)),(h===0?e+i>=p:r+i>=y)&&(o.push(f+1),o.push(d),o.push(w))}return a}function Gt(n,t,e,r){const i=n-e,s=t-r;return i*i+s*s}const ur=n=>n[0],lr=n=>n[1];class Z{constructor(t,e=ur,r=lr,i=64,s=Float64Array){this.nodeSize=i,this.points=t;const o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),l=this.coords=new s(t.length*2);for(let h=0;h<t.length;h++)a[h]=h,l[2*h]=e(t[h]),l[2*h+1]=r(t[h]);bt(a,l,i,0,a.length-1,0)}range(t,e,r,i){return ar(this.ids,this.coords,t,e,r,i,this.nodeSize)}within(t,e,r){return hr(this.ids,this.coords,t,e,r,this.nodeSize)}}class cr{constructor(){new Worker("assets/PhysicsWorker.ebf41cd3.js",{type:"module"})}}class fr{constructor(t,e,r){c(this,"m_workers");c(this,"m_rand_engine");c(this,"m_leaves",[]);c(this,"m_branches",[]);c(this,"m_kd_candidates",null);c(this,"m_kd_branches",null);c(this,"m_kd_endpoints",{});c(this,"m_endpoints",[]);c(this,"m_min_distance");c(this,"m_max_distance");this.m_min_distance=t,this.m_max_distance=e,this.m_rand_engine=r,this.m_workers=new cr}get Leaves(){return this.m_leaves}get Branches(){return this.m_branches}get BranchKD(){return this.m_kd_branches}get EndPoints(){return this.m_endpoints}spawn_attractor(t,e){this.m_leaves=[];for(let r=0;r<e;r++){let i=this.m_rand_engine.integer(t.xMin,t.xMax),s=this.m_rand_engine.integer(t.yMin,t.yMax),o=L(i,s);this.m_leaves.push({position:o,reached:!1})}this.m_kd_candidates=new Z(this.m_leaves,r=>r.position[0],r=>r.position[1],this.m_leaves.length,Float32Array)}spawn_free_branch(t,e){this.m_branches=[];let r=new Pt(L(t,e),null);r.direction=L(0,-1),this.m_branches.push(r);let i=r;this.m_leaves.length;let s=5e4;for(;this.m_branches.length<s&&i!=null;){let o=!1,a=this.m_kd_candidates.within(i.position[0],i.position[1],this.m_max_distance),l=a.length;for(let h=0;h<l;h++){let d=this.m_leaves[a[h]];Ft(i.position,d.position)<this.m_max_distance&&(o||(o=!0))}if(!o){let h=i.next();i=h,this.m_branches.push(h);continue}i=null}this.m_kd_branches=new Z(this.m_branches,o=>o.position[0],o=>o.position[1],this.m_leaves.length,Float32Array)}grow_branch(){let t=this.m_leaves.length,e=this.m_branches.length;for(let s=0;s<t;s++){let o=this.m_leaves[s],a=null,l=this.m_max_distance,h=this.m_kd_branches.within(o.position[0],o.position[1],this.m_max_distance),d=h.length;for(let u=d-1;u>=0;u--){let f=this.m_branches[h[u]],p=Ft(f.position,o.position);if(p<this.m_min_distance){o.reached=!0,a=null;break}else p<l&&f.candidate_count<f.max_candidate&&(a=f,l=p)}if(a!=null){let u=J(E(),o.position,a.position);tt(u,u),a.direction=V(a.direction,a.direction,u),a.count++,a.candidate_count++}}let r=0;for(let s=t-1;s>=0;s--)this.m_leaves[s].reached&&this.m_leaves.splice(s,1);for(let s=e-1;s>=0;s--){var i=this.m_branches[s];if(i.count>0){let o=i.direction;r++,yt(o,o,1/(i.count+1)),i.set_direction(o);let a=i.next();this.m_kd_endpoints[a.id]=a,i.id in this.m_kd_endpoints&&delete this.m_kd_endpoints[i.id],this.m_branches.push(a),i.reset()}}return this.m_kd_candidates=new Z(this.m_leaves,s=>s.position[0],s=>s.position[1],this.m_leaves.length,Float32Array),this.m_kd_branches=new Z(this.m_branches,s=>s.position[0],s=>s.position[1],this.m_branches.length,Float32Array),r}calculate_branch_width(){let t=Object.keys(this.m_kd_endpoints),e=t.length;for(let r=0;r<e;r++){let i=this.m_kd_endpoints[t[r]];for(;i!=null;){i.set_branch_type(i.thickness);let s=i.parent;if(s==null)break;if(s.child_count<=i.child_count)s.child_count=i.child_count+1;else break;i=s}}}}class dr{constructor(t){c(this,"m_ctx");this.m_ctx=t}DrawRoundRect(t){this.m_ctx.translate(t.x+t.radius,t.y),this.m_ctx.rotate(-t.angle),this.m_ctx.fillStyle="green",this.m_ctx.fillRect(0,-t.radius,t.length,t.radius*2),this.DrawSphere(0,0,t.radius),this.DrawSphere(t.length,0,t.radius),this.m_ctx.resetTransform()}DrawSphere(t,e,r,i){this.m_ctx.beginPath(),this.m_ctx.arc(t,e,r,0,2*Math.PI),this.m_ctx.fillStyle="rgba(255, 0, 0, 0.5)",this.m_ctx.closePath(),this.m_ctx.fill(),this.m_ctx.globalAlpha=1}DrawLine(t,e,r){this.m_ctx.lineWidth=r;let i="orange",s="green";this.m_ctx.strokeStyle="black",r<15&&(this.m_ctx.strokeStyle=s),r<3&&(this.m_ctx.strokeStyle=i),this.m_ctx.beginPath(),this.m_ctx.moveTo(t[0],t[1]),this.m_ctx.lineTo(e[0],e[1]),this.m_ctx.stroke()}DrawRect2D(t,e,r,i){this.m_ctx.beginPath(),this.m_ctx.fillStyle="black",this.m_ctx.moveTo(t[0],t[1]),this.m_ctx.lineTo(e[0],e[1]),this.m_ctx.lineTo(i[0],i[1]),this.m_ctx.lineTo(r[0],r[1]),this.m_ctx.fill()}DrawImage(t,e,r){this.m_ctx.resetTransform(),r.translation!=null&&this.m_ctx.translate(r.translation[0],r.translation[1]),r.rotation!=null&&(this.m_ctx.rotate(r.rotation),this.m_ctx.translate(-r.translation[0],-r.translation[1])),this.m_ctx.drawImage(t,e[0]+r.dx,e[1]+r.dy,t.width*r.base_scale*r.target_scale,t.height*r.base_scale*r.target_scale),this.m_ctx.resetTransform()}DrawWire(t,e,r){let i=t[0],s=t[1];this.m_ctx.lineWidth=r,this.m_ctx.beginPath(),this.m_ctx.arc(i,s,e,0,2*Math.PI,!1),this.m_ctx.strokeStyle="blue",this.m_ctx.stroke(),this.m_ctx.lineWidth=1}Clear(t,e){this.m_ctx.clearRect(0,0,t,e)}}class pr{constructor(t,e,r,i){c(this,"x");c(this,"y");c(this,"m_width");c(this,"m_height");c(this,"m_center",E());this.x=t,this.y=e,this.m_width=r,this.m_height=i}get width(){return this.m_width}get height(){return this.m_height}get width_half(){return this.m_width*0,5}get height_half(){return this.m_height*.5}get center(){return this.m_center[0]=this.x+this.width_half,this.m_center[1]=this.y+this.height_half,this.m_center}get xMin(){return this.x}get xMax(){return this.x+this.m_width}get yMin(){return this.y}get yMax(){return this.y+this.m_height}}const ae=Object.freeze({leave_01:"./assets/textures/leaf-01.png"}),Qt=Object.freeze({Leaf_ThinBranch_Rate:.5,Leaf_Endpoint_Rate:.8});class _r{constructor(t,e,r,i){c(this,"m_branch");c(this,"lerp_t");c(this,"relative_angle");c(this,"scale");this.m_branch=t,this.lerp_t=e,this.relative_angle=r,this.scale=i}}var he=(n=>(n[n.Branch=0]="Branch",n[n.Leaf=1]="Leaf",n[n.Complete=2]="Complete",n))(he||{});class vr{constructor(t,e,r){c(this,"m_space_colonization");c(this,"m_simple_canvas");c(this,"m_canvas_helper");c(this,"m_resource");c(this,"m_rand_engine");c(this,"m_construction_flag",0);c(this,"m_last_process_index",0);this.m_rand_engine=e,this.m_resource=r,this.m_simple_canvas=t,this.m_canvas_helper=new dr(this.m_simple_canvas.Context),this.m_space_colonization=new fr(20,100,this.m_rand_engine);let i=this.m_simple_canvas.ScreenHeight*.5,s=new pr(this.m_simple_canvas.ScreenWidth*.2,0,this.m_simple_canvas.ScreenWidth*.6,i);this.m_space_colonization.spawn_attractor(s,200),this.m_space_colonization.spawn_free_branch(this.m_simple_canvas.ScreenWidth*.5,this.m_simple_canvas.ScreenHeight)}get construct_flag(){return this.m_construction_flag}construct_on_the_fly(){switch(this.m_canvas_helper.Clear(this.m_simple_canvas.ScreenWidth,this.m_simple_canvas.ScreenHeight),this.m_construction_flag){case 0:{this.draw_candidates(this.m_space_colonization.Leaves),this.draw_branch(this.m_space_colonization.Branches);let t=this.m_space_colonization.grow_branch();this.m_space_colonization.calculate_branch_width(),t==0&&(this.m_space_colonization.Branches.forEach(e=>{this.calculate_leaf(e)}),this.m_construction_flag=1)}case 1:{let t=3,e=this.m_space_colonization.Branches.length,r=se(this.m_last_process_index+t,e,0);this.draw_branch(this.m_space_colonization.Branches);for(let i=0;i<r;i++)this.draw_leaf(this.m_space_colonization.Branches[i],this.m_last_process_index/e);this.m_last_process_index=r,this.m_last_process_index==e&&(this.m_construction_flag=2)}}}render(){this.m_canvas_helper.Clear(this.m_simple_canvas.ScreenWidth,this.m_simple_canvas.ScreenHeight);let t=this.m_space_colonization.Branches.length;this.m_space_colonization.EndPoints.length,this.draw_branch(this.m_space_colonization.Branches);for(let e=0;e<t;e++){let r=this.m_space_colonization.Branches[e];this.draw_leaf(r,1),r.child_count==1&&this.m_canvas_helper.DrawSphere(r.position[0],r.position[1],10,.5)}}async draw_control_point(t){}draw_candidates(t){let e=t.length;for(let r=0;r<e;r++){let i=t[r];this.m_canvas_helper.DrawSphere(i.position[0],i.position[1],3)}}draw_branch(t){let e=t.length;for(let r=0;r<e;r++){let i=t[r];i.parent!=null&&(i.is_vertices_set&&i.parent.is_vertices_set?this.m_canvas_helper.DrawRect2D(i.branch_vertices[0],i.branch_vertices[1],i.parent.branch_vertices[0],i.parent.branch_vertices[1]):this.m_canvas_helper.DrawLine(i.parent.position,i.position,i.thickness))}}async calculate_leaf(t){if(t.branch_leaf.length>0||t.branch_type.type==Y.Thick_Branch)return;let e=this.m_rand_engine.realZeroToOneInclusive();if(t.branch_type.type==Y.Thin_Branch&&e>Qt.Leaf_ThinBranch_Rate||t.branch_type.type==Y.Endpoint_Branch&&e>Qt.Leaf_Endpoint_Rate)return;let r=this.m_rand_engine.integer(1,3);for(let i=0;i<r;i++){let s=this.m_rand_engine.realZeroToOneExclusive(),o=$t(E(),t.position,t.parent.position,s);o=J(o,o,t.position);let a=.25,l=this.m_rand_engine.real(-1,1)*Math.PI*a,h=this.m_rand_engine.real(-1,1)*Math.PI*a,d=L(l,h);tt(d,d);let u=Math.atan2(d[1],d[0]),f=new _r(t,s,u,.5);t.branch_leaf.push(f)}}draw_leaf(t,e){let r=t.branch_leaf.length,i=this.m_resource.ForceGetImage(ae.leave_01);for(let s=0;s<r;s++){let o=t.branch_leaf[s],a=$t(E(),t.position,t.parent.position,o.lerp_t),l={base_scale:o.scale,target_scale:e,dx:0,dy:0};l.translation=a;let h=L(t.direction[0],t.direction[1]);tt(h,h),l.rotation=Math.atan2(h[1],h[0])+o.relative_angle,l.dy=-i.height*.5*l.base_scale*l.target_scale,this.m_canvas_helper.DrawImage(i,a,l)}}}class mr{constructor(t,e){c(this,"m_sc_canvas");c(this,"m_simple_canvas");c(this,"m_rand_engine");c(this,"m_resource");c(this,"m_inputHandler");c(this,"m_mouse_position");this.m_rand_engine=this.get_random_engine(e),this.m_mouse_position=E(),this.m_inputHandler=new ze,this.m_resource=new tr,this.m_simple_canvas=new qe(t),this.m_sc_canvas=new vr(this.m_simple_canvas,this.m_rand_engine,this.m_resource),this.m_simple_canvas.Dom.addEventListener("mousemove",r=>{this.on_mouse_event(r.clientX,r.clientY,X.Hover)}),this.m_simple_canvas.Dom.addEventListener("mousedown",r=>{this.on_mouse_event(r.clientX,r.clientY,X.Down)}),this.m_simple_canvas.Dom.addEventListener("mouseup",r=>{this.on_mouse_event(r.clientX,r.clientY,X.Up)}),this.process_preparation_stage()}async process_preparation_stage(){await this.m_resource.GetImage(ae.leave_01),window.requestAnimationFrame(this.update.bind(this))}update(){this.m_sc_canvas.construct_flag!=he.Complete?this.m_sc_canvas.construct_on_the_fly():this.m_sc_canvas.render(),window.requestAnimationFrame(this.update.bind(this))}get_random_engine(t){return t==null?new jt(B.autoSeed()):new jt(B.seed(t))}on_mouse_event(t,e,r){this.m_mouse_position[0]=t,this.m_mouse_position[1]=e,this.m_sc_canvas.draw_control_point(this.m_mouse_position)}}let Zt=new URLSearchParams(window.location.search),ue;Zt.has("seed")&&(ue=parseInt(Zt.get("seed")));new mr("#canvas_board",ue);
